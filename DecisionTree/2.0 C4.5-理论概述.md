# C4.5理论概述

#### 概述

C4.5由罗斯.昆兰在ID3的基础上提出的

弥补ID3上的缺陷 ——”具有里程碑意义的决策树“

用俗话说就是”该调的都调了  能解决所有的分类问题 

但还差点意思 不能预测回归问题“

#### 基本概念

在ID3的基础上 做了如下调整

1. 使用信息增益率作为划分标准

2. 引入剪枝，防止过拟合

3. 特征可以是连续值 也可以有缺失值

#### 关键点

##### 信息增益率

$$
\begin{eqnarray}
Gain\_ratio(D,a) & = & \frac{Gain(D,a)}{IV(a)} \\
IV(a) & = & -\sum_{\nu=1 }^{V}\frac{|D^{\nu }|}{|D|}log_{2}\frac{|D^{\nu }|}{|D|}
\end{eqnarray}
$$

使用信息增益率作为划分标准 但是依然会有产生类似的问题 

信息增益率会对取值较少的特征有所偏好

因此实际使用过程中 使用了启发式的算法

**先选出信息增益高于平均值的特征 再从中选择信息增益率最高的特征作为划分点**

##### 连续值处理

因为连续特征的可取值数目很多

因此不能像前面处理离散特征枚举离散特征取值来对结点进行划分

需要连续属性离散化，常用的离散化策略是二分法

先将连续特征的值进行从小到大排序

再取两个数之间的均值作为划分点

**若当前划分结点为连续特征，该特征还可作为其后代结点的划分特征，只是两次划分点不同**

如下述*计算步骤第3步*

##### 缺失值处理

现实生活中的数据集中的样本通常在某系特征上是缺失的

如果属性值缺失的样本数量比较少，我们可以直接简单粗暴的把不完备的样本删除掉

但是如果有大量的样本都有属性值的缺失，那么就不能简单地删除

因为这样删除了大量的样本，对于模型而言损失了大量有用的信息，训练出来的模型性能会受到影响。

因此决策树是如何解决缺失值的？

在决策树中处理含有缺失值的样本的时候，需要解决三个问题:

- Q:如何在特征值缺失的情况下计算信息增益？

  ​	比如“色泽”这个特征有的样本在该特征上的值是缺失的，那么该如何计算“色泽”的信息增益？

  A:先计算该特征下剔除缺失值的样本后的信息增益，再乘以(1-该特征的缺失率) 为最终的信息增益

     如下述*计算步骤第1步*

- Q:给定划分特征 若该样本在特征上的值是缺失的 那么如何对这个样本进行划分

  A:该样本同时进入”色泽“这个特征下的各个分支中，且对各个分支下的这个样本增加权重 
  
     权重值=该特征下的当前分支的样本个数/该特征下的样本总个数

- Q:当我们构造完一棵决策树后，对新的样本进行测试时，如果测试样本的属性有缺失值该如何处理？

  A:测试样本在该属性值上有缺失值，就同时进入所有分支，然后算每个label的概率，取最大概率的label

#### 计算步骤

以一份有连续值和缺失值的西瓜数据集的数据作为样例 进行计算

| 编号 | 色泽 | 根蒂 | 敲声 | 纹理 | 脐部 | 触感 | 密度  | 好瓜(标签) |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ----- | ---------- |
| 1    |      | 蜷缩 | 浊响 | 清晰 | 凹陷 | 硬滑 | 0.697 | 是         |
| 2    | 乌黑 | 蜷缩 | 沉闷 | 清晰 | 凹陷 |      | 0.774 | 是         |
| 3    | 乌黑 | 蜷缩 |      | 清晰 | 凹陷 | 硬滑 | 0.634 | 是         |
| 4    | 青绿 | 蜷缩 | 沉闷 | 清晰 | 凹陷 | 硬滑 | 0.608 | 是         |
| 5    |      | 蜷缩 | 浊响 | 清晰 | 凹陷 | 硬滑 | 0.556 | 是         |
| 6    | 青绿 | 稍蜷 | 浊响 | 清晰 |      | 软粘 | 0.403 | 是         |
| 7    | 乌黑 | 稍蜷 | 浊响 | 稍糊 | 稍凹 | 软粘 | 0.481 | 是         |
| 8    | 乌黑 | 稍蜷 | 浊响 |      | 稍凹 | 硬滑 | 0.437 | 是         |
| 9    | 乌黑 |      | 沉闷 | 稍糊 | 稍凹 | 硬滑 | 0.666 | 否         |
| 10   | 青绿 | 硬挺 | 清脆 |      | 平坦 | 软粘 | 0.243 | 否         |
| 11   | 浅白 | 硬挺 | 清脆 | 模糊 | 平坦 |      | 0.245 | 否         |
| 12   | 浅白 | 蜷缩 |      | 模糊 | 平坦 | 软粘 | 0.343 | 否         |
| 13   |      | 稍蜷 | 浊响 | 稍糊 | 凹陷 | 硬滑 | 0.639 | 否         |
| 14   | 浅白 | 稍蜷 | 沉闷 | 稍糊 | 凹陷 | 硬滑 | 0.657 | 否         |
| 15   | 乌黑 | 稍蜷 | 浊响 | 清晰 |      | 软粘 | 0.36  | 否         |
| 16   | 浅白 | 蜷缩 | 浊响 | 模糊 | 平坦 | 硬滑 | 0.593 | 否         |
| 17   | 青绿 |      | 沉闷 | 稍糊 | 稍凹 | 硬滑 | 0.719 | 否         |

1.计算各个特征的信息增益率

特征分别为：色泽、根蒂、敲声、纹理、脐部、触感 、密度

以色泽为例 色泽样本中具有缺失值

​	1.1计算数据的信息熵

​		该特征上无缺失值的样本为14个 则无缺失样本概率$\varphi =\frac{14}{17}$ 其中正样本概率$\varphi_{正} =\frac{6}{14} $，负样本概率$\varphi_{负} =\frac{8}{14} $ 
$$
\begin{eqnarray}
Ent(\tilde{D}) &=& - \sum_{k=1}^{2}\varphi_{k}log_{2}\varphi_{k} \\
~&=&  -(\frac{6}{14}log_{2}\frac{6}{14}+\frac{8}{14}log_{2}\frac{8}{14} ) \\
~&=& 0.9852
\end{eqnarray}
$$

​	1.2 计算各个特征值得信息熵
$$
\begin{eqnarray}
Ent(\tilde{D}_{色泽}^{青绿}) &=& - (\frac{2}{4}log_2\frac{2}{4}+\frac{2}{4}log_2\frac{2}{4})=1 \\
Ent(\tilde{D}_{色泽}^{乌黑}) &=& - (\frac{2}{6}log_2\frac{2}{6}+\frac{4}{6}log_2\frac{4}{6})=0.9183\\
Ent(\tilde{D}_{色泽}^{浅白}) &=& - (\frac{0}{4}log_2\frac{0}{4}+\frac{4}{4}log_2\frac{4}{4})=0 \\
\end{eqnarray}
$$
​	1.3 计算信息增益率
$$
\begin{eqnarray}
Gain(\tilde{D},色泽) &= & Ent(\tilde{D}) - (\frac{4}{14}\times Ent(\tilde{D}_{色泽}^{青绿})+ \frac{6}{14}\times Ent(\tilde{D}_{色泽}^{乌黑})+\frac{4}{14}\times Ent(\tilde{D}_{色泽}^{浅白})) \\
~& = & 0.9852 - (\frac{4}{14} \times 1 + \frac{6}{14} \times 0.9183 +\frac{4}{14}\times 0 ) \\
~& = & 0.306  \\
Gain(D,色泽) &= & \varphi \times Gain(\tilde{D},色泽) \\
                   ~& = & \frac{14}{17} \times 0.306 \\
                   ~& = & 0.252 \\
IV(色泽) & = & - (\frac{4}{14}log_{2}\frac{4}{14} + \frac{6}{14}log_{2}\frac{6}{14}+\frac{4}{14}log_{2}\frac{4}{14}) \\
       ~& = & 1.5566  \\
Gain\_ratio(D,色泽) & = & \frac{Gain(D,色泽)}{IV(色泽)} \\
~& = & \frac{0.252}{1.5566} \\
~& = & 0.1619
\end{eqnarray}
$$
2.同理计算各特征的信息增益率
$$
\begin{eqnarray}
Gain\_ratio(D,根蒂) & = &  0.1198 \quad Gain(D,根蒂)=0.1712 \\
Gain\_ratio(D,敲声) & = &  0.1035 \quad Gain(D,敲声)=0.1448 \\
Gain\_ratio(D,纹理) & = &  0.2813 \quad Gain(D,纹理)=0.4236\\
Gain\_ratio(D,脐部) & = &  0.1887 \quad Gain(D,脐部)=0.2888\\
Gain\_ratio(D,触感) & = &  0.0062 \quad Gain(D,触感)=0.0057\\
\end{eqnarray}
$$
3.计算连续值的信息增益率

特征:密度为连续值 

​	3.1 先计算划分点

​			将各个密度值进行从小到大排序，再取两个数之间的均值作为划分点

​            得到划分点

$[0.244, 0.294, 0.352, 0.382, 0.42, 0.459, 0.518, 0.574, 0.6, 0.621, 0.637, 0.648, 0.662, 0.682, 0.708, 0.746]$

​	3.2 计算数据的信息熵
$$
\begin{eqnarray}
Ent(D) &=& - \sum_{k=1}^{2}\varphi_{k}log_{2}\varphi_{k} \\
~&=&  -(\frac{8}{17}log_{2}\frac{8}{17}+\frac{9}{17}log_{2}\frac{9}{17} ) \\
~&=& 0.998
\end{eqnarray}
$$
​	3.3 计算各个划分点的信息增益率
$$
\begin{eqnarray}
当t=0.244时: \\
D_{t}^{-}& =& \{0.243\} \quad D_{t}^{+} = \{0.245,0.343,...,0.719,0.774\} \\
Ent(D_{t}^{-}) &=&-(0\times log_{2}0+1\times log_{2}1) = 0 \\
Ent(D_{t}^{+}) &=&-(\frac{8}{16}\times log_{2}\frac{8}{16}+\frac{8}{16}\times log_{2}\frac{8}{16})=1\\
Gain(D,密度,0.244) &= & 0.998-(\frac{1}{17}\times 0+\frac{16}{17}\times 1  ) = 0.0563 \\
Gain\_ratio(D,密度,0.244) &= &  \frac{Gain(D,密度,0.244)}{IV(密度,0.244)} = \frac{0.057}{-(\frac{1}{17}\times log_{2}\frac{1}{17}+\frac{16}{17}\times log_{2}\frac{16}{17})} = \frac{0.0563}{0.3227} = 0.1744  \\
==============&=&========================================\\
同理:\\
当t=0.294 时:\\
Gain(D,密度,0.294) &= & 0.118 \\
Gain\_ratio(D,密度,0.294) &= & 0.2258  \\
==============&=&====\\
当t=0.352时:\\
Gain(D,密度,0.352) &= & 0.1861 \\
Gain\_ratio(D,密度,0.352) &= & 0.2768  \\
==============&=&====\\
当t=0.382时:\\
Gain(D,密度,0.382) &= & 0.2624 \\
Gain\_ratio(D,密度,0.382&=& 0.3334  \\
==============&=&====\\
当t=0.42\\
Gain(D,密度,0.4) &= & 0.0935 \\
Gain\_ratio(D,密度,0.4) &= & 0.107  \\
==============&=&====\\
当t=0.459\
Gain(D,密度,0.352) &= & 0.0302\\
Gain\_ratio(D,密度,0.352) &= & 0.0322  \\
\end{eqnarray}
$$

4. 计算划分点

   各划分点的信息信息增益及信息增益率 如下

   | 划分点         | 信息增益 | 信息增益率 |
   | -------------- | -------- | ---------- |
   | (D,根蒂)       | 0.1712   | 0.1198     |
   | (D,敲声)       | 0.1448   | 0.1035     |
   | (D,纹理)       | 0.4236   | 0.2813     |
   | (D,脐部)       | 0.2888   | 0.1887     |
   | (D,触感)       | 0.0057   | 0.0062     |
   | (D,密度,0.244) | 0.0563   | 0.1744     |
   | (D,密度,0.294) | 0.118    | 0.2258     |
   | (D,密度,0.352) | 0.1861   | 0.2768     |
   | (D,密度,0.382) | 0.2624   | 0.3334     |
   | (D,密度,0.4)   | 0.0935   | 0.107      |
   | (D,密度,0.352) | 0.0302   | 0.0322     |

   划分点:$max(\{信息增益≥avg(信息增益)\})_{信息增益率}=(D,密度,0.352)$​​​


#### 总结

